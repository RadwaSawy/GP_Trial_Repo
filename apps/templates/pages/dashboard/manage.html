{% extends 'layouts/base.html' %}


{% block content %}
{% if not user.is_authenticated %}

<a id="login" href="/accounts/sign-in/">Login</a>
{% endif %}

<div class="py-4">
</div>
<div class="row">
  <div class="accordion accordion-flush" id="accordionFlushExample">
    <div class="accordion-item mb-4">
      <h2 class="accordion-header" id="flush-headingOne">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
          data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseTwo">
          <h2 class="h5">Add Location</h2>
        </button>
      </h2>
      <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
        data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          <div class="card card-body border-0 shadow mb-4">
            <form method="POST">
              <input type="hidden" name="Location_form" value="1">
              <div class="row align-items-center">
                <div class="col-md-6 mb-3">
                  <div>
                    <label for="first_name">Location</label>
                    <input class="form-control" type="text" name="location" id="location" aria-label="Location select example" placeholder="Enter your location"
                      required>
                  </div>
                </div>
                <!--<div class="col-md-6 mb-3">
                  <label for="location">Location</label>
                  <select class="form-select mb-0" id="location" aria-label="Location select example">
                    <option selected>Location</option>
                    <option value="1">Cairo</option>
                    <option value="2">Alex</option>
                    <option value="3">Giza</option>
                    <option value="4">October</option>
                    <option value="5">Maadi</option>
                  </select>
                </div>-->
              </div>
              <div class="mt-3">
                <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Save Location</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item mb-4">
      <h2 class="accordion-header" id="flush-headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
          data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
          <h2 class="h5">Add Employee</h2>
        </button>
      </h2>
      <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo"
        data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          <div class="card card-body border-0 shadow mb-4">
            <form method="POST">
              <input type="hidden" name="Employee_form" value="1">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div>
                    <label for="name">Name</label>
                    <input class="form-control" name="name" id="name" type="text" placeholder="Enter your name"
                      required>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="gender">Gender</label>
                  <select class="form-select mb-0" name="gender" id="gender" aria-label="Gender select example">
                    <option selected>Gender</option>
                    <option value="1">Female</option>
                    <option value="2">Male</option>
                  </select>
                </div>
                <!--<div class="col-md-6 mb-3">
                  <div>
                    <label for="last_name">Last Name</label>
                    <input class="form-control" name="last_name" id="last_name" type="text" placeholder="Also your last name" required>
                  </div>
                </div>-->
              </div>
              <div class="row align-items-center">
                <!--<div class="col-md-6 mb-3">
                  <label for="birthday">Birthday</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <svg class="icon icon-xs" fill="currentColor" viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                          d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
                          clip-rule="evenodd"></path>
                      </svg>
                    </span>
                    <input data-datepicker="" class="form-control" name="birthday" id="birthday" type="text" placeholder="dd/mm/yyyy"
                      required>
                  </div>
                </div>-->
                
              </div>
              <div class="row">
                <!--<div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="email">Email</label>
                    <input class="form-control" name="email" id="email" type="email" placeholder="name@company.com" required>
                  </div>
                </div>-->
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="id">ID</label>
                    <input class="form-control" name="id" id="id" type="number" placeholder="202018018" required>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="location">Location</label>
                  <select class="form-select mb-0" name="location" id="empolyee_location" aria-label="Location select example">
                 
                  </select>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Save Member</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>




    <!--Adding Employee Report-->
    <div class="col-12 col-8">
      <div class="row">
        <div class="col-12 col-6 mb-4">
          <div class="card border-0 shadow">
            <div class="card-header border-bottom d-flex align-items-center justify-content-between">
              <h2 class="fs-5 fw-bold mb-0">Employee Report</h2>
            </div>
            <div class="card-body">
              <ul id="employee-report-list"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var employeeReportList = document.getElementById('employee-report-list');
    
        fetch('/employee_report')
          .then(response => response.json())
          .then(data => {
            data.forEach(employee => {
              var listItem = document.createElement('li');
    
              var heading = document.createElement('h2');
              heading.textContent = employee.Name;
              listItem.appendChild(heading);
    
              var idParagraph = document.createElement('p');
              idParagraph.textContent = 'ID: ' + employee.ID;
              listItem.appendChild(idParagraph);
    
              var locationParagraph = document.createElement('p');
              locationParagraph.textContent = 'Location: ' + employee.Location;
              listItem.appendChild(locationParagraph);
    
              var resultsParagraph = document.createElement('p');
              resultsParagraph.textContent = 'Results: ' + employee.Results;
              listItem.appendChild(resultsParagraph);
    
              employeeReportList.appendChild(listItem);
            });
          })
          .catch(error => console.error('Error:', error));
      });
    </script>
    
    
    <!--End of Adding Employee Report-->
    



    <div class="col-12 col-8">
      <div class="row">
        <div class="col-12 col-6 mb-4">
          <div class="card border-0 shadow">
            <div class="card-header border-bottom d-flex align-items-center justify-content-between">
              <h2 class="fs-5 fw-bold mb-0">Employees Statistics</h2>
              <!--<a href="#" class="btn btn-sm btn-primary">See all</a> -->         
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush list my--3" id="employee-list"></ul>
            </div>
            
            <!--<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
              document.addEventListener('DOMContentLoaded', function() {
                // Fetch data from the server
                fetch('/satisfied_employees')
                  .then(response => response.json())
                  .then(data => {
                    var top_members = data.top_members;
                    var counts = data.counts;
            
                    // Get the employee list element
                    var employeeList = document.getElementById('employee-list');
            
                    // Generate list items for each employee
                    for (var i = 0; i < top_members.length; i++) {
                      var member = top_members[i];
                      var count = counts[i];
            
                      // Create the list item
                      var listItem = document.createElement('li');
                      listItem.className = 'list-group-item px-0';
            
                      // Create the row container
                      var rowContainer = document.createElement('div');
                      rowContainer.className = 'row align-items-center';
            
                      // Create the content column
                      var contentColumn = document.createElement('div');
                      contentColumn.className = 'col';
            
                      // Create the heading and link
                      var heading = document.createElement('h4');
                      heading.className = 'h6 mb-0';
            
                      var link = document.createElement('a');
                      link.href = '#';
                      link.textContent = member;
            
                      // Create the small text
                      var smallText = document.createElement('div');
                      smallText.className = 'small fw-bold text-gray-500';
                      smallText.textContent = count + ' Satisfied Customers';
            
                      // Append link and small text to heading
                      heading.appendChild(link);
                      heading.appendChild(smallText);
            
                      // Create the progress bar
                      var progressBar = document.createElement('div');
                      progressBar.className = 'progress mb-0';
            
                      var progressBarInner = document.createElement('div');
                      progressBarInner.className = 'progress-bar bg-success';
                      progressBarInner.setAttribute('role', 'progressbar');
                      progressBarInner.setAttribute('aria-valuenow', count);
                      progressBarInner.setAttribute('aria-valuemin', '0');
                      progressBarInner.setAttribute('aria-valuemax', '100');
                      progressBarInner.style.width = count + '%';
            
                      // Append progress bar inner to progress bar
                      progressBar.appendChild(progressBarInner);
            
                      // Append heading and progress bar to content column
                      contentColumn.appendChild(heading);
                      contentColumn.appendChild(progressBar);
            
                      // Append content column to row container
                      rowContainer.appendChild(contentColumn);
            
                      // Append row container to list item
                      listItem.appendChild(rowContainer);
            
                      // Append list item to employee list
                      employeeList.appendChild(listItem);
                    }
                  })
                  .catch(error => console.error('Error:', error));
              });
            </script>-->
            


            <div class="card-body">
                <ul class="list-group list-group-flush list my--3" id="employee-list"></ul>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                  // Fetch data from the server
                  fetch('/satisfied_employees')
                    .then(response => response.json())
                    .then(data => {
                      var top_members = data.top_members;
                      var counts = data.counts;

                      // Get the employee list element
                      var employeeList = document.getElementById('employee-list');

                      // Generate list items for each employee
                      for (var i = 0; i < top_members.length; i++) {
                        var member = top_members[i];
                        var count = counts[i];

                        // Create the list item
                        var listItem = document.createElement('li');
                        listItem.className = 'list-group-item px-0';

                        // Create the row container
                        var rowContainer = document.createElement('div');
                        rowContainer.className = 'row align-items-center';

                        // Create the content column
                        var contentColumn = document.createElement('div');
                        contentColumn.className = 'col';

                        // Create the heading and link
                        var heading = document.createElement('h4');
                        heading.className = 'h6 mb-0';

                        var link = document.createElement('a');
                        link.href = '#';
                        link.textContent = member;

                        // Create the small text
                        var smallText = document.createElement('div');
                        smallText.className = 'small fw-bold text-gray-500';
                        smallText.textContent = count + ' Satisfied Customers';

                        // Append link and small text to heading
                        heading.appendChild(link);
                        heading.appendChild(smallText);

                        // Create the progress bar
                        var progressBar = document.createElement('div');
                        progressBar.className = 'progress mb-0';

                        var progressBarInner = document.createElement('div');
                        progressBarInner.className = 'progress-bar bg-success';
                        progressBarInner.setAttribute('role', 'progressbar');
                        progressBarInner.setAttribute('aria-valuenow', count);
                        progressBarInner.setAttribute('aria-valuemin', '0');
                        progressBarInner.setAttribute('aria-valuemax', '100');
                        progressBarInner.style.width = count + '%';

                        // Append progress bar inner to progress bar
                        progressBar.appendChild(progressBarInner);

                        // Append heading and progress bar to content column
                        contentColumn.appendChild(heading);
                        contentColumn.appendChild(progressBar);

                        // Append content column to row container
                        rowContainer.appendChild(contentColumn);

                        // Append row container to list item
                        listItem.appendChild(rowContainer);

                        // Append list item to employee list
                        employeeList.appendChild(listItem);
                      }
                    })
                    .catch(error => console.error('Error:', error));
                });
            </script>
                <!--Adding the bar chart-->
              <canvas id="employee-chart"></canvas>
              <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                
              <script>
                  document.addEventListener('DOMContentLoaded', function() {
                    var ctx = document.getElementById('employee-chart').getContext('2d');
                
                    // Fetch data from the server
                    fetch('/satisfied_employees')
                      .then(response => response.json())
                      .then(data => {
                        var top_members = data.top_members;
                        var counts = data.counts;
                
                        // Create the chart using Chart.js
                        var myChart = new Chart(ctx, {
                          type: 'bar',
                          data: {
                            labels: top_members,
                            datasets: [{
                              label: 'Top Members with High Number of Satisfied Customers',
                              data: counts,
                              backgroundColor: 'rgba(54, 162, 235, 0.5)', // Change the background color
                              borderColor: 'rgba(54, 162, 235, 1)', // Change the border color
                              borderWidth: 1,
                              barPercentage: 0.2, // Adjust the bar width
                              categoryPercentage: 0.5 // Adjust the bar width
                            }]
                          },
                          options: {
                            scales: {
                              y: {
                                beginAtZero: true
                              }
                            }
                          }
                        });
                      })
                      .catch(error => console.error('Error:', error));
                  });
              </script>
              
              <!--ENd of Displaying Bar Chart-->

              <!--Displaying the bar chart-->



      <div class="col-12 col-6 mb-4">
        <div class="card border-0 shadow">
          <div class="card-header border-bottom d-flex align-items-center justify-content-between">
            <h2 class="fs-5 fw-bold mb-0">Locations Statistics</h2>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush list my--3">
              {% for location_stat in top_locations %}
              <li class="list-group-item px-0">
                <div class="row align-items-center">
                  <div class="col">
                    <h4 class="h6 mb-0">
                      <a href="#">{{ location_stat }}</a>
                      <div class="small fw-bold text-gray-500">
                        <span>{{ location_stat.satisfied_customers }} Satisfied Customers</span>
                        <span class="ml-2">{{ counts[loop.index0] }} Counts</span>
                      </div>
                    </h4>
                    <div class="progress mb-0">
                      <div class="progress-bar bg-success" role="progressbar" aria-valuenow="75" aria-valuemin="0"
                        aria-valuemax="100" style="width: {{ location_stat.progress_percentage }}%;"></div>
                    </div>
                  </div>
                </div>
              </li>
              {% endfor %}
            </ul>
          </div>
          <!--yaara addition starts here-->
                  <!--<canvas id="location-chart" width="400" height="200"></canvas>-->
          <div class="card-body">
            <ul class="list-group list-group-flush list my--3" id="location-list"></ul>
          </div>
              
          <canvas id="location-chart"></canvas>
      
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              // Fetch data from the server
              fetch('/satisfied_locations')
                .then(response => response.json())
                .then(data => {
                  var top_locations = data.top_locations;
                  var counts = data.counts;
      
                  // Get the location list element
                  var locationList = document.getElementById('location-list');
      
                  // Generate list items for each location
                  for (var i = 0; i < top_locations.length; i++) {
                    var location = top_locations[i];
                    var count = counts[i];
      
                    // Create the list item
                    var listItem = document.createElement('li');
                    listItem.className = 'list-group-item px-0';
      
                    // Create the row container
                    var rowContainer = document.createElement('div');
                    rowContainer.className = 'row align-items-center';
      
                    // Create the content column
                    var contentColumn = document.createElement('div');
                    contentColumn.className = 'col';
      
                    // Create the heading and link
                    var heading = document.createElement('h4');
                    heading.className = 'h6 mb-0';
      
                    var link = document.createElement('a');
                    link.href = '#';
                    link.textContent = location;
      
                    // Create the small text
                    var smallText = document.createElement('div');
                    smallText.className = 'small fw-bold text-gray-500';
                    smallText.textContent = count + ' Satisfied Customers';
      
                    // Append link and small text to heading
                    heading.appendChild(link);
                    heading.appendChild(smallText);
      
                    // Create the progress bar
                    var progressBar = document.createElement('div');
                    progressBar.className = 'progress mb-0';
      
                    var progressBarInner = document.createElement('div');
                    progressBarInner.className = 'progress-bar bg-success';
                    progressBarInner.setAttribute('role', 'progressbar');
                    progressBarInner.setAttribute('aria-valuenow', count);
                    progressBarInner.setAttribute('aria-valuemin', '0');
                    progressBarInner.setAttribute('aria-valuemax', '100');
                    progressBarInner.style.width = count + '%';
      
                    // Append progress bar inner to progress bar
                    progressBar.appendChild(progressBarInner);
      
                    // Append heading and progress bar to content column
                    contentColumn.appendChild(heading);
                    contentColumn.appendChild(progressBar);
      
                    // Append content column to row container
                    rowContainer.appendChild(contentColumn);
      
                    // Append row container to list item
                    listItem.appendChild(rowContainer);
      
                    // Append list item to location list
                    locationList.appendChild(listItem);
                  }
                })
                .catch(error => console.error('Error:', error));
            });
      
            //Adding the bar chart
            var ctx = document.getElementById('location-chart').getContext('2d');
      
            // Fetch data from the server
            fetch('/satisfied_locations')
              .then(response => response.json())
              .then(data => {
                var top_locations = data.top_locations;
                var counts = data.counts;
      
                // Create the chart using Chart.js
                var myChart = new Chart(ctx, {
                  type: 'bar',
                  data: {
                    labels: top_locations,
                    datasets: [{
                      label: 'Top Locations with High Number of Satisfied Customers',
                      data: counts,
                      backgroundColor: 'rgba(54, 162, 235, 0.5)', // Change the background color
                      borderColor: 'rgba(54, 162, 235, 1)', // Change the border color
                      borderWidth: 1,
                      barPercentage: 0.2, // Adjust the bar width
                      categoryPercentage: 0.5 // Adjust the bar width
                    }]
                  },
                  options: {
                    scales: {
                      y: {
                        beginAtZero: true
                      }
                    }
                  }
                });
              })
              .catch(error => console.error('Error:', error));
          </script>
          <!--yaara addition ends here-->
        </div>
      </div>
              
    
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% endblock content %}