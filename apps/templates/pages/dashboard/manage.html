{% extends 'layouts/base.html' %}


{% block content %}
{% if not user.is_authenticated %}

<a id="login" href="/accounts/sign-in/">Login</a>
{% endif %}

<div class="py-4">
</div>
<div class="row">
  <div class="accordion accordion-flush" id="accordionFlushExample">
    <div class="accordion-item mb-4">
      <h2 class="accordion-header" id="flush-headingOne">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
          data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseTwo">
          <h2 class="h5">Add Location</h2>
        </button>
      </h2>
      <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne"
        data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          <div class="card card-body border-0 shadow mb-4">
            <form method="POST">
              <input type="hidden" name="Location_form" value="1">
              <div class="row align-items-center">
                <div class="col-md-6 mb-3">
                  <div>
                    <label for="first_name">Location</label>
                    <input class="form-control" type="text" name="location" id="location"
                      aria-label="Location select example" placeholder="Enter your location" required>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Save Location</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="accordion-item mb-4">
      <h2 class="accordion-header" id="flush-headingTwo">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
          data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
          <h2 class="h5">Add Employee</h2>
        </button>
      </h2>
      <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo"
        data-bs-parent="#accordionFlushExample">
        <div class="accordion-body">
          <div class="card card-body border-0 shadow mb-4">
            <form method="POST">
              <input type="hidden" name="Employee_form" value="1">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div>
                    <label for="name">Name</label>
                    <input class="form-control" name="name" id="name" type="text" placeholder="Enter your name"
                      required>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="gender">Gender</label>
                  <select class="form-select mb-0" name="gender" id="gender" aria-label="Gender select example">
                    <option selected>Gender</option>
                    <option value="1">Female</option>
                    <option value="2">Male</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <div class="form-group">
                    <label for="id">ID</label>
                    <input class="form-control" name="id" id="id" type="number" placeholder="202018018" required>
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="location">Location</label>
                  <select class="form-select mb-0" name="location" id="empolyee_location"
                    aria-label="Location select example">

                  </select>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-gray-800 mt-2 animate-up-2" type="submit">Save Member</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--Adding Employee Report-->
  <div class="col-12 col-8">
    <div class="row">
      <div class="col-12 col-6 mb-4">
        <div class="card border-0 shadow">
          <div class="card-header border-bottom d-flex align-items-center justify-content-between">
            <h2 class="fs-5 fw-bold mb-0">Employee Report</h2>
          </div>
          <style>
            /* Style the table */
            table {
                font-family: Arial, sans-serif;
                border-collapse: collapse;
                width: 100%;
            }
            
            /* Style the table header */
            th {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
            }
            
            /* Style the table cells */
            td {
                border: 1px solid #ddd;
                padding: 8px;
            }
            
            /* Style the table rows on hover */
            tr:hover {
                background-color: #f5f5f5;
            }
            
            /* Style the table header */
            th {
                padding-top: 12px;
                padding-bottom: 12px;
                background-color: #4CAF50;
                color: white;
            }
        </style>
        <table>
          <tr>
              <th>Name</th>
              <th>Member ID</th>
              <th>Location Address</th>
              <th>No. of Satisfied Customers</th>
          </tr>
        </table>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
        $(document).ready(function() {
            // Retrieve the data from the server
            fetch('/employee_report')
                .then(response => response.json())
                .then(data => {
                    // Update the HTML table with the data
                    
                    data.forEach(result => {
                        $('#employee-table tbody').append(
                            `<tr>
                                <td>${result.name}</td>
                                <td>${result.member_id}</td>
                                <td>${result.location_address}</td>
                                <td>${result.count}</td>
                            </tr>`
                        );
                    });
                });
        });
        </script>
        </div>
      </div>
    </div>
  </div>
</div>
<!--End of Adding Employee Report-->

<!--Adding Employee Statistics-->

<div class="row">
  <div class="col-12 col-6 mb-4">
    <div class="card border-0 shadow">
      <div class="card-header border-bottom d-flex align-items-center justify-content-between">
        <h2 class="fs-5 fw-bold mb-0">Employees Statistics</h2>
        <!--<a href="#" class="btn btn-sm btn-primary">See all</a> -->
      </div>
      <div class="card-body p-2">
        <ul class="list-group list-group-flush list my--3" id="employee-list"></ul>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          // Fetch data from the server
          fetch('/satisfied_employees')
            .then(response => response.json())
            .then(data => {
              var top_members = data.top_members;
              var counts = data.counts;

              // Get the employee list element
              var employeeList = document.getElementById('employee-list');

              // Generate list items for each employee
              for (var i = 0; i < top_members.length; i++) {
                var member = top_members[i];
                var count = counts[i];

                // Create the list item
                var listItem = document.createElement('li');
                listItem.className = 'list-group-item px-0';

                // Create the row container
                var rowContainer = document.createElement('div');
                rowContainer.className = 'row align-items-center';

                // Create the content column
                var contentColumn = document.createElement('div');
                contentColumn.className = 'col';

                // Create the heading and link
                var heading = document.createElement('h4');
                heading.className = 'h6 mb-0';

                var link = document.createElement('a');
                link.href = '#';
                link.textContent = member;

                // Create the small text
                var smallText = document.createElement('div');
                smallText.className = 'small fw-bold text-gray-500';
                smallText.textContent = count + ' Satisfied Customers';

                // Append link and small text to heading
                heading.appendChild(link);
                heading.appendChild(smallText);

                // Create the progress bar
                var progressBar = document.createElement('div');
                progressBar.className = 'progress mb-0';

                var progressBarInner = document.createElement('div');
                progressBarInner.className = 'progress-bar bg-success';
                progressBarInner.setAttribute('role', 'progressbar');
                progressBarInner.setAttribute('aria-valuenow', count);
                progressBarInner.setAttribute('aria-valuemin', '0');
                progressBarInner.setAttribute('aria-valuemax', '100');
                progressBarInner.style.width = count + '%';

                // Append progress bar inner to progress bar
                progressBar.appendChild(progressBarInner);

                // Append heading and progress bar to content column
                contentColumn.appendChild(heading);
                contentColumn.appendChild(progressBar);

                // Append content column to row container
                rowContainer.appendChild(contentColumn);

                // Append row container to list item
                listItem.appendChild(rowContainer);

                // Append list item to employee list
                employeeList.appendChild(listItem);
              }
            })
            .catch(error => console.error('Error:', error));
        });
      </script>
    </div>
  </div>



  <!-- Adding the bar chart -->
  <div class="col-12  mb-4">
    <div class="col-12 px-0 mb-4">
      <div class="card border-0 shadow h-100">
        <div class="card-body">
          <div class="ct-chart employee-chart ct-golden-section"></div>
        </div>

        <!-- Include Chartist library -->

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Initialize the chart after the DOM is loaded -->
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            // Fetch data from the server
            fetch('/satisfied_employees')
              .then(response => response.json())
              .then(data => {
                var top_members = data.top_members;
                var counts = data.counts;

                // Create the chart using Chartist
                var chart = new Chartist.Bar('.employee-chart', {
                  labels: top_members,
                  series: [counts]
                }, {
                  low: 0,
                  showArea: true,
                  plugins: [
                    Chartist.plugins.tooltip()
                  ],
                  axisX: {
                    position: 'end'
                  },
                  axisY: {
                    showGrid: false,
                    showLabel: false,
                    offset: 0
                  }
                });

                chart.on('draw', function (data) {
                  if (data.type === 'line' || data.type === 'area') {
                    data.element.animate({
                      document: {
                        begin: 2000 * data.index,
                        dur: 2000,
                        from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),
                        to: data.path.clone().stringify(),
                        easing: Chartist.Svg.Easing.easeOutQuint
                      }
                    });
                  }
                });
              })
              .catch(error => console.error('Error:', error));
          });
        </script>

        <!--ENd of Displaying Bar Chart-->

        <!--Displaying the bar chart-->
      </div>
    </div>
  </div>
</div>



<!--Adding Location Statistics-->
<div class="col-12 col-8">
  <div class="row">
    <div class="col-12 col-6 mb-4">
      <div class="card border-0 shadow">
        <div class="card-header border-bottom d-flex align-items-center justify-content-between">
          <h2 class="fs-5 fw-bold mb-0">Locations Statistics</h2>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush list my--3">
            {% for location_stat in top_locations %}
            <li class="list-group-item px-0">
              <div class="row align-items-center">
                <div class="col">
                  <h4 class="h6 mb-0">
                    <a href="#">{{ location_stat }}</a>
                    <div class="small fw-bold text-gray-500">
                      <span>{{ location_stat.satisfied_customers }} Satisfied Customers</span>
                      <span class="ml-2">{{ counts[loop.index0] }} Counts</span>
                    </div>
                  </h4>
                  <div class="progress mb-0">
                    <div class="progress-bar bg-success" role="progressbar" aria-valuenow="75" aria-valuemin="0"
                      aria-valuemax="100" style="width:'{{ location_stat.progress_percentage }}';">
                    </div>
                  </div>
                </div>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
        <!--yaara addition starts here-->
        <!--<canvas id="location-chart" width="400" height="200"></canvas>-->
        <div class="card-body">
          <ul class="list-group list-group-flush list my--3" id="location-list"></ul>
        </div>
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            // Fetch data from the server
            fetch('/satisfied_locations')
              .then(response => response.json())
              .then(data => {
                console.log(data)
                var top_locations = data.top_locations;
                var counts = data.counts;

                // Get the location list element
                var locationList = document.getElementById('location-list');

                // Generate list items for each location
                for (var i = 0; i < top_locations.length; i++) {
                  var location = top_locations[i];
                  var count = counts[i];

                  // Create the list item
                  var listItem = document.createElement('li');
                  listItem.className = 'list-group-item px-0';

                  // Create the row container
                  var rowContainer = document.createElement('div');
                  rowContainer.className = 'row align-items-center';

                  // Create the content column
                  var contentColumn = document.createElement('div');
                  contentColumn.className = 'col';

                  // Create the heading and link
                  var heading = document.createElement('h4');
                  heading.className = 'h6 mb-0';

                  var link = document.createElement('a');
                  link.href = '#';
                  link.textContent = location;

                  // Create the small text
                  var smallText = document.createElement('div');
                  smallText.className = 'small fw-bold text-gray-500';
                  smallText.textContent = count + ' Satisfied Customers';

                  // Append link and small text to heading
                  heading.appendChild(link);
                  heading.appendChild(smallText);

                  // Create the progress bar
                  var progressBar = document.createElement('div');
                  progressBar.className = 'progress mb-0';

                  var progressBarInner = document.createElement('div');
                  progressBarInner.className = 'progress-bar bg-success';
                  progressBarInner.setAttribute('role', 'progressbar');
                  progressBarInner.setAttribute('aria-valuenow', count);
                  progressBarInner.setAttribute('aria-valuemin', '0');
                  progressBarInner.setAttribute('aria-valuemax', '100');
                  progressBarInner.style.width = count + '%';

                  // Append progress bar inner to progress bar
                  progressBar.appendChild(progressBarInner);

                  // Append heading and progress bar to content column
                  contentColumn.appendChild(heading);
                  contentColumn.appendChild(progressBar);

                  // Append content column to row container
                  rowContainer.appendChild(contentColumn);

                  // Append row container to list item
                  listItem.appendChild(rowContainer);

                  // Append list item to location list
                  locationList.appendChild(listItem);
                }
              })
              .catch(error => console.error('Error:', error));
          });
        </script>
      </div>
    </div>
  </div>

  <div class="col-12  mb-4">
    <div class="col-12 px-0 mb-4">
      <div class="card border-0 shadow h-100">
        <div class="card-body">
          <div class="ct-chart location-chart ct-golden-section ct-series-a">
          </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


        <script>
          document.addEventListener('DOMContentLoaded', function () {
            // Fetch data from the server
            fetch('/satisfied_locations')
              .then(response => response.json())
              .then(data => {
                var top_locations = data.top_locations;
                var counts = data.counts;

                // Create the chart using Chartist
                var chart = new Chartist.Bar('.location-chart', {
                  labels: top_locations,
                  series: [counts]
                }, {
                  low: 0,
                  showArea: true,
                  plugins: [
                    Chartist.plugins.tooltip()
                  ],
                  axisX: {
                    position: 'end'
                  },
                  axisY: {
                    showGrid: false,
                    showLabel: false,
                    offset: 0
                  }
                });

                chart.on('draw', function (data) {
                  if (data.type === 'line' || data.type === 'area') {
                    data.element.animate({
                      document: {
                        begin: 2000 * data.index,
                        dur: 2000,
                        from: data.path.clone().scale(1, 0).translate(0, data.chartRect.height()).stringify(),
                        to: data.path.clone().stringify(),
                        easing: Chartist.Svg.Easing.easeOutQuint
                      }
                    });
                  }
                });
              })
              .catch(error => console.error('Error:', error));
          });
        </script>


        <!--yaara addition ends here-->
      </div>
    </div>
  </div>
</div>
</div>


{% endblock content %}